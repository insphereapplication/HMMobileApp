<div class="ui-page ui-body-b ui-page-active" data-role="page">
	<div data-nobackbtn="true" data-role="header" class="ui-bar-b ui-header" role="banner">
		<h1 class="ui-title" tabindex="0" role="heading" aria-level="1">Opportunities</h1>
	</div>
	<div data-role="navbar" class="ui-navbar ui-navbar-noicons" role="navigation">
		<ul class="ui-grid-b">
			<li class="ui-block-a"><a class="ui-btn ui-btn-up-a" data-transition="none" data-theme="a" href="<%= url_for(:action => :index) %>"><span class="ui-btn-inner"><span class="ui-btn-text">New Leads</span></span></a></li>
			<li class="ui-block-b"><a data-transition="none" data-theme="a" href="<%= url_for(:action => :index_follow_up) %>" class="ui-btn ui-btn-active ui-btn-up-a"><span class="ui-btn-inner"><span class="ui-btn-text">Follow-Up</span></span></a></li>
			<li class="ui-block-c"><a data-transition="none" data-theme="a" href="<%= url_for(:action => :index_appointments) %>" class="ui-btn ui-btn-up-a"><span class="ui-btn-inner"><span class="ui-btn-text">Appts</span></span></a></li>
		</ul>
	</div>
	<div data-role="content" class="ui-content" role="main">
		<ul data-counttheme="e" data-split-theme="b" data-split-icon="phoneopp" data-role="listview" class="ui-listview" role="listbox">
		<% [[@past_due_follow_ups, 
				"Past Due", 
				"red", 
				lambda {|opportunity| "Due: -#{opportunity.days_past_due} d" unless opportunity.days_past_due.blank?}],
			[@todays_follow_ups, 
				"Today", 
				"orange", 
				lambda {|opportunity| "Today: #{opportunity.next_activity_due_date}" unless opportunity.next_activity_due_date.blank?}],
			[@last_activities, 
				"By Last Activity", 
				"yellow", 
				lambda {|opportunity| "Last Act: -#{DateUtil.days_ago(opportunity.last_activity_date)}d" unless opportunity.last_activity_date.blank?}],
			[@future_follow_ups, 
				"Future", 
				"green", 
				lambda {|opportunity| "Due: #{DateUtil.days_from_now(opportunity.next_activity_due_date)}d" unless opportunity.next_activity_due_date.blank?}]].each do |follow_ups, label, color, date_proc| %>
			
				<li data-role="list-divider" role="heading" tabindex="0" class="ui-li ui-li-divider ui-btn ui-bar-<%=color%> ui-btn-up-undefined"><%= label %></li> 
				<% follow_ups.each do |item| %>
					<% opportunity = item.kind_of?(Activity) ? item.opportunity : item %>
					<%= render :partial =>"opportunity", :locals => { 
							:opportunity => opportunity, 
							:color => color, 
							:top_right_text => opportunity.rollup_status,
							:bottom_right_text => date_proc.call(opportunity),
							:origin => "followup"
						 } 
					%>
				<% end %>
				<% if follow_ups.count == 0 %>
					<li><div style="text-align:center"><i> (No Opportunities in this Category) </i></div></li>
				<% end %>
			<% end %>
		</ul>
	</div>
	
</div>
