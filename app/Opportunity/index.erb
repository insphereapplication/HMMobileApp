<div class="ui-page ui-body-b ui-page-active" data-role="page">
	<div data-nobackbtn="true" data-role="header" class="ui-bar-b ui-header" role="banner">
		<h1 class="ui-title" tabindex="0" role="heading" aria-level="1">Opportunities</h1>
	</div>
	<div data-role="navbar" class="ui-navbar ui-navbar-noicons" role="navigation">
		<ul class="ui-grid-b">
			<li class="ui-block-a"><a id="new-leads-button" class="tab-button ui-btn ui-btn-active ui-btn-up-a " data-transition="none" data-theme="a" href="#"><span class="ui-btn-inner"><span class="ui-btn-text">New Leads</span></span></a></li>
			<li class="ui-block-b"><a id="follow-up-button" class="tab-button ui-btn ui-btn-up-a" data-transition="none" data-theme="a" ><span class="ui-btn-inner"><span class="ui-btn-text">Follow-Up</span></span></a></li>
			<li class="ui-block-c"><a id="appointments-button" class="tab-button ui-btn ui-btn-up-a" data-transition="none" data-theme="a" ><span class="ui-btn-inner"><span class="ui-btn-text">Appts</span></span></a></li>
		</ul>
	</div>
	
	<div id="new-leads" data-role="content" class="ui-content opp-tab" role="main">
		<ul data-counttheme="e" data-split-theme="b" data-split-icon="phoneopp" data-role="listview" class="ui-listview" role="listbox">
			<% [[@todays_new_leads, "Today", "red"], 
				[@previous_days_leads, "Previous Days", "orange"]].each do |leads, label, color| %>
				    <li data-role="list-divider" role="heading" tabindex="0" class="ui-li ui-li-divider ui-btn ui-bar-<%=color%> ui-btn-up-undefined"><%= label %></li> 
					<% leads.each do |opportunity| %>
						<% contact = opportunity.contact %>
						<%= render :partial =>"opportunity", :locals => { 
							:opportunity => opportunity	, 
							:color => color, 
							:bottom_right_text => "Created #{DateUtil.days_ago_formatted(opportunity.createdon)}",
							:top_right_text => to_datetime_noyear(opportunity.createdon),
							:origin => "newleads",
							:launcher => :phone_dialog,
							:icon => "phoneopp",
							:location => "blank"
						} %>
					
					<% end %>
					<% if leads.count == 0 %>
						<li><div style="text-align:center"><i> (No Opportunities in this Category) </i></div></li>
					<% end %>
			<% end %>
		</ul>
	</div>
	<div id="follow-ups" data-role="content" class="ui-content opp-tab" role="main">
		<ul data-counttheme="e" data-split-theme="b" data-split-icon="phoneopp" data-role="listview" class="ui-listview" role="listbox">
		<% [[@past_due_follow_ups, 
				"Past Due", 
				"red", 
				lambda {|phone_call| "Due: -#{phone_call.days_past_due} d" unless phone_call.days_past_due.blank?}],
			[@todays_follow_ups, 
				"Today", 
				"orange", 
				lambda {|phone_call| "Today #{phone_call.scheduledend.hour_string }"}],

			[@last_activities, 
				"By Last Activity", 
				"yellow", 
				lambda {|opportunity| "Last Act: -#{DateUtil.days_ago(opportunity.cssi_lastactivitydate)}d" unless opportunity.cssi_lastactivitydate.blank?}],
				
			[@future_follow_ups, 
				"Future", 
				"green", 
				lambda {|phone_call| "Due: #{DateUtil.days_from_now(phone_call.scheduledend)}d" }]].each do |follow_ups, label, color, date_proc| %>
			
				<li data-role="list-divider" role="heading" tabindex="0" class="ui-li ui-li-divider ui-btn ui-bar-<%=color%> ui-btn-up-undefined"><%= label %></li> 
				<% follow_ups.each do |item| %>
					<% opportunity = item.kind_of?(Activity) ? item.opportunity : item %>
					<%= render :partial =>"opportunity", :locals => { 
							:opportunity => opportunity, 
							:color => color, 
							:top_right_text => opportunity.cssi_statusdetail,
							:bottom_right_text => date_proc.call(item),
							:origin => "followup",
							:launcher => :phone_dialog,
							:icon => "phoneopp",
							:location => "blank"
						 } 
					%>
				<% end %>
				<% if follow_ups.count == 0 %>
					<li><div style="text-align:center"><i> (No Opportunities in this Category) </i></div></li>
				<% end %>
			<% end %>
		</ul>
	</div>
	<div id="appointments" data-role="content" class="ui-content opp-tab" role="main">
		<ul data-counttheme="e" data-split-theme="b" data-split-icon="phoneopp" data-role="listview" class="ui-listview" role="listbox">
			<% [[@past_due_appointments, "Past Due", "red"],
				[@todays_appointments, "Today", "orange"], 
				[@future_appointments, "Future", "green"]].each do |appointments, label, color| %>
					<li data-role="list-divider" role="heading" tabindex="0" class="ui-li ui-li-divider ui-btn ui-bar-<%=color%> ui-btn-up-undefined"><%=label%></li> 
					<% appointments.each do |appointment| %>
						<% contact = appointment.parent.contact %>
						<% opportunity = appointment.parent %>
					
						<%= render :partial =>"opportunity", 
							:locals => { 
								:opportunity => opportunity	, 
								:color => color, 
								:bottom_right_text => "Created #{opportunity.days_ago}",
								:top_right_text => to_datetime_noyear(appointment.scheduledstart),
								:origin => "appointments",
								:launcher => :map,
								:icon => "mapopp",
								:location => appointment.location
							} 
						%>
				<% end %>
				<% if appointments.count == 0 %>
					<li><div style="text-align:center"><i> (No Opportunities in this Category) </i></div></li>
				<% end %>
			<% end %>
		</ul>
	</div>
</div>


	
