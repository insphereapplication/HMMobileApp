<script type="text/javascript" >
$(document).ready( function(){
	var replace = $('li[two-icons] div span');
	if ( replace.length = 1 ) // We can only have 1 preferred number, so only one of these will have the attribute
	{
		replace.replaceWith('<span class="ui-icon ui-icon-delete" style="float:right; position:relative;"></span><span class="ui-icon ui-icon-add" style="float:right; right:-30px; position:relative;"></span>');
	}
});
</script>

<div data-role="page" data-theme="b" data-cache="never">
	<%= offline_bar%>
	<div data-role="header" data-backbtn="false">
				<% if @params['origin'] == "contact"%>
					<a href="<%=url_for(:action => :index)%>" data-direction="reverse" rel="external" data-icon="back">Contacts</a>
				<% else %>
					<a href="<%=url_for(:controller=>:Opportunity, :action=>:show, :id => @params['opportunity'], :query=>{:origin => @params['origin']})%>" data-direction="reverse" rel="external" data-icon="back">Opp</a>
				<% end %>
				<h1>Contact Detail</h1>
				<a href="<%=url_for(:action=>:edit, :id => @contact.object, :query => {:opportunity => @params['opportunity'], :origin => @params['origin']})%>" data-direction="forward" data-icon="gear"> Edit </a>
	</div>
			<div data-role="content">
				<ul data-role="listview" data-theme="d" data-inset="true" > 
					<li>
							<h3><%= @contact.full_name %></h3>
							<p><%= @contact.gendercode %>, Age <%= (@contact.age).to_s %> </p>
							<p>DOB: <%= to_date(@contact.birthdate) %></p>		
					</li> 
					
					<% if @contact.mobilephone %>
						<li <%= check_preferred_and_donotcall("Mobile", @contact.cssi_preferredphone, @contact.cssi_allowcallsmobilephone) %> ><a href="tel: <%= @contact.mobilephone.to_s %>"> Mobile: <%= @contact.mobilephone %></a></li>
					<% else %>
						<li data-icon="false"><a href="#">Mobile:</a></li>
					<% end %>
					
					<% if @contact.telephone1 %>
						<li <%= check_preferred_and_donotcall("Business", @contact.cssi_preferredphone, @contact.cssi_allowcallsbusinessphone) %> ><a href="tel: <%= @contact.telephone1.to_s %>">Bus: <%= @contact.telephone1 %></a>
							<% if (@contact.cssi_businessphoneext != nil || @contact.cssi_businessphoneext == "")%> 
								<!-- <div align="center"><p> -->x<%= @contact.cssi_businessphoneext %><!-- </p></div> -->
							<% end %>
						</li>
					<% else %>
						<li data-icon="false"><a href="#">Bus:</a></li>
					<% end %>
					
					<% if @contact.telephone2 %>
						<li <%= check_preferred_and_donotcall("Home", @contact.cssi_preferredphone, @contact.cssi_allowcallshomephone) %> ><a href="tel: <%= @contact.telephone2.to_s %>">Home: <%= @contact.telephone2 %></a></li>
					<% else %>
						<li data-icon="false"><a href="#">Home:</a></li>
					<% end %>
					
					<% if @contact.telephone3 %>
						<li <%= check_preferred_and_donotcall("Alternate", @contact.cssi_preferredphone, @contact.cssi_allowcallsalternatephone) %> ><a href="tel: <%= @contact.telephone3.to_s %>">Alternate: <%= @contact.telephone3 %></a></li>
					<% else %>
						<li data-icon="false"><a href="#">Alternate:</a></li>
					<% end %>
					
					<% if @contact.emailaddress1 %>
					<li data-icon="false"><a href="mailto:<%= @contact.emailaddress1.to_s %>"><%= "Email: #{@contact.emailaddress1.to_s}" %></a></li>
					<% else %>
					<li data-icon="false"><a href="#">Email:</a></li>
					<% end %>
					<li data-role="list-divider">Home Address</li>
					<li data-icon="false">
						<% if @contact.home_city %>
							<% if System::get_property('platform') == 'APPLE'%>
								<a onclick="hideSpin()" href=<%="maps:q=#{@contact.home_map}"%>>
										<%= @contact.address1_line1 %>
										<%= @contact.address1_line2 %><br/>
										<%= @contact.home_city %><br/>
								</a>
							<% else %>
								<a rel="external" href=<%="http://maps.google.com/?rho_open_target=_blank&q=#{@contact.home_map}"%>>
										<%= @contact.address1_line1 %>
										<%= @contact.address1_line2 %><br/>
										<%= @contact.home_city %><br/>
								</a>
							<% end %>
						<% else %>
							<a href="#"> (None) </a>
						<% end %>
					</li>
					<li data-role="list-divider">Business Address</li>
					<li data-icon="false">
						<% if @contact.business_city %>
							<% if System::get_property('platform') == 'APPLE'%>
								<a onclick="hideSpin()" href=<%="maps:q=#{@contact.business_map}"%>>
									<%= @contact.address2_line1 %>
									<%= @contact.address2_line2 %><br/>
									<%= @contact.business_city %><br/>
								</a>
							<% else %>
								<a onclick="hideSpin()" href=<%="http://maps.google.com/?rho_open_target=_blank&q=#{@contact.home_map}"%>>
									<%= @contact.address2_line1 %>
									<%= @contact.address2_line2 %><br/>
									<%= @contact.business_city %><br/>
								</a>
							<% end %>
						<% else %>
							<a href="#"> (None) </a>
						<% end %>
					</li>
				</ul>
				<div data-role="collapsible" data-collapsed="true">
					<% if @contact.has_spouse_info? %>
						<h3>Spouse - <%= @contact.cssi_spousename %>&nbsp;<%= @contact.cssi_spouselastname %></h3>
					<% else %>
						<h3>Spouse</h3>
					<% end %>
					<ul data-role="listview" data-filter="false" data-inset="true">
						<li data-role="list-divider">Spouse</li>
						<% if @contact.has_spouse_info? %>
							<li>
								<a href="<%= url_for(:controller => :Contact, :action => :spouse_show, :id => @contact.object, :query => {:origin => "contact"}) %>"></a>
								<p></p><p><b><%= @contact.cssi_spousename %>&nbsp;<%= @contact.cssi_spouselastname%></b></p>
								<p><%= @contact.cssi_spousegender %>, Age 36</p>
								<p>DOB: <%= to_date(@contact.cssi_spousebirthdate) %></p>
							</li>
						<% else %>
							<li data-icon="add">
								<a href="<%= url_for(:controller => :Contact, :action => :spouse_add, :id => @contact.object, :query => {:origin => "contact"}) %>">Add Spouse</a>
							</li>
						<% end %>
					</ul>
				</div>
				<div data-role="collapsible" data-collapsed="true">
					<% if @contact.dependents.size == 0 %>
						<h3>Dependents</h3>
					<% else %>	
						<h3>Dependents - <%= @contact.dependents.size %></h3>
					<% end %>
					<ul data-role="listview" data-filter="false" data-inset="true">
						<li data-role="list-divider">Dependents</li>
						<li data-icon="add">
							<a href="<%= url_for(:controller => :Contact, :action => :dependent_add, :id => @contact.object, :query => {:origin => "contact"}) %>">Add Dependent</a>
						</li>
						<% @contact.dependents.each do |dependent| %>
						<li>
							<a href="<%= url_for(:controller => :Dependent, :action => :show, :id => dependent.object, :query => {:origin => "contact"}) %>"></a>
							<p></p><p><b><%= dependent.cssi_name %>&nbsp;<%= dependent.cssi_lastname %></b></p>
							<p><%= dependent.cssi_gender %>, Age <%= dependent.cssi_age %></p>
							<p>DOB: <%= to_date(dependent.cssi_dateofbirth) %></p>
						</li>
						<% end %>
					</ul>
				</div>
				<ul data-role="listview" data-filter="false" data-inset="true">
					<li data-role="list-divider">Policies</li>
					<% @contact.policies.each do |policy| %>
					<li>
						<a href="<%= url_for(:controller => :Policy, :action => :show, :id => policy.object, :query => {:origin => "contact"}) %>">
							<p>Carrier: <%= policy.carrier_name %></p>
							<p>Application Date: <%= to_date(policy.cssi_applicationdate) %></p>
							<p>Status: <%= policy.cssi_statusreason %></p>
						</a>
					</li>
					<% end %>
					<% if @contact.policies.size == 0 %>
						<li><div style="text-align:center"><i> (No Policies) </i></div></li>
					<% end %>
				</ul>
				<% if @params['origin'] == "contact" %>
				 <ul data-role="listview" data-filter="false" data-inset="true">
					<li data-role="list-divider">Opportunities</li>
						<% @contact.opportunities.each do |opportunity| %>
						<li>
							<a href="<%= url_for(:controller => :Opportunity, :action => :show, :id => opportunity.object, :query => {:origin => "contact"}) %>"> 
								<strong><%= to_date(opportunity.createdon) %></strong> <TEST> <%= opportunity.rollup_status %>
							</a>
						</li>
						<% end %>
				 </ul>
				<% end %>
			</div>
			
</div>